<!doctype html>
<html>
<head>
<title>COVID Incarcerated</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="../bootstrap.min.js"></script>
<link href="../bootstrap.min.css" rel="stylesheet">
<link href="../bootstrap-theme.min.css" rel="stylesheet">
<script type="text/javascript">

  var spData = null;
  function doData(json) {
      spData = json.feed.entry;
  }

  function drawChart(titleText,divID,input) {
    var data = google.visualization.arrayToDataTable(input);

    var options = {
      title: titleText,
      legend: 'none',
      focusTarget: 'category',
      isStacked: true,
      hAxis: {
        format: 'Y-MM-dd'
        //gridlines: {color: '#333', minSpacing: 1}
      }
    };

    var chart = new google.visualization.AreaChart(document.getElementById(divID));

    chart.draw(data, options);
  }

  function readData() {
      var data = spData;
      var columns = new Array();

      var parsedData = new Array();

      dateFormatter = new google.visualization.DateFormat({pattern: "Y-MM-dd", timeZone: +7});

      var currentType = "";
      var tmp = [];
      var residentArray = new Array();
      var officerArray = new Array();
      var otherArray = new Array();

      for(var r=0; r<data.length; r++) {
          var cell = data[r]["gs$cell"];
          var val = cell["$t"];
          if (cell.row==1){
            tmp.push(val);
            if (cell.col==1){
              currentType = val;
            }
          }
          if (cell.row>1 && cell.col==1 && tmp.length>0){
            if (currentType=="Resident Cases" || currentType==""){
              residentArray.push(tmp);
            }
            if (currentType=="Officer Cases" || currentType==""){
              officerArray.push(tmp);
            }
            if (currentType=="Other Cases" || currentType==""){
              otherArray.push(tmp);
            }
            tmp = [];
            currentType = val;
          }
          if (cell.row>1 && cell.col==2){
            tmp.push(new Date(Date.parse(val)));
            //tmp.push(dateFormatter.formatValue(new Date(Date.parse(val))));
          }
          else if (cell.row>1 && cell.col>2){
            tmp.push(parseInt(val));
          }
      }


      if (tmp.length>0){
        if (currentType=="Resident Cases" || currentType==""){
          residentArray.push(tmp);
        }
        if (currentType=="Officer Cases" || currentType==""){
          officerArray.push(tmp);
        }
        if (currentType=="Other Cases" || currentType==""){
          otherArray.push(tmp);
        }
        tmp = [];
      }

      var ticks = [];
      var nonresidentArray = new Array();
      nonresidentArray.push(otherArray[0]);
      for (var i=1; i<officerArray.length; i++){
        var t1 = officerArray[i];
        var t2 = otherArray[i];
        var tt = [t1[0]];
        for (var j=1; j<t1.length; j++){
          tt.push(t1[j]+t2[j]);
        }
        nonresidentArray.push(tt);
        ticks.push({v:t1[0],f:t1[0]});
      }

      console.log(ticks);

      drawChart("Resident Cases", "resident_div", residentArray);
      drawChart("Non-Resident Cases", "nonresident_div", nonresidentArray);
  }
  $(document).ready(function(){
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(readData);
  });
</script>

<script src="https://spreadsheets.google.com/feeds/cells/1NAxNw4f8CFbhKmjLm7SrHtLQVgJt5XXrukAslxzTyU0/1/public/full?alt=json-in-script&callback=doData"></script>

<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">
</head>

<body style="width: 90%;margin: auto;">

<center><h3>COVID Incarcerated Maryland</h3></center>
<br>

<center>
<div id="resident_div" style="width: 100%;"></div>
<br>
<div id="nonresident_div" style="width: 100%;"></div>
</center>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>


</body>
</html>
